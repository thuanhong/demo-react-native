(self.webpackJsonp=self.webpackJsonp||[]).push([[5],{502:function(e,t,n){"use strict";var a=n(0),s=n(441),o=n(588),i=n(159);t.a=Object(i.a)(class extends a.Component{componentDidUpdate(e){this.props.visible&&this.props.viewer!==e.viewer&&this.props.onComplete()}render(){return a.createElement(s.a,{visible:this.props.visible,onDismiss:this.props.onDismiss,title:"Log in to Expo"},a.createElement(o.a,{onSuccess:this.props.onSuccess,onError:this.props.onError}))}})},627:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n(1),o=n(37),i=n.n(o),r=n(7),p=n(521),l=n(170),c=n.n(l),u=n(159),d=n(2),h=n(42),m=n(20),g=n(87),b=n.n(g),f=n(85);var y=n(502),v=n(52),w=n(171);function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=Object(r.a)(Object(u.a)(class extends a.PureComponent{constructor(){super(...arguments),k(this,"state",{initialId:this.props.wasUpgraded?void 0:this.props.snackId,isLoggingIn:!1,payerCodeFormStatus:{type:"closed"},appetizeStatus:{type:"unknown"},autoplay:!1,viewer:this.props.viewer,platform:this.props.platform,sdkVersion:this.props.sdkVersion}),k(this,"handleLaunchRequest",()=>{m.a.getInstance().logEvent("RAN_EMULATOR")}),k(this,"handlePayerCodeLink",()=>{this.setState({payerCodeFormStatus:{type:"open",value:""}}),m.a.getInstance().logEvent("REQUESTED_APPETIZE_CODE",{},"previewQueue")}),k(this,"handlePostMessage",e=>{let t=e.origin,n=e.data;if(t===h.a.appetize.url){let e;switch(this.waitingForMessage&&(clearInterval(this.waitingForMessage),this.waitingForMessage=null),n){case"sessionRequested":e={type:"requested"};break;case"sessionConnecting":e={type:"connecting"};break;case"appLaunch":e={type:"launch"},this.props.onAppLaunch&&this.props.onAppLaunch(),"queued"===this.state.appetizeStatus.type&&m.a.getInstance().logEvent("APP_LAUNCHED",{},"previewQueue"),m.a.getInstance().clearTimer("previewQueue");break;case"timeoutWarning":e={type:"timeout"};break;case"sessionEnded":e={type:"unknown"},m.a.getInstance().clearTimer("previewQueue");break;case"accountQueued":e={type:"queued",position:void 0};break;default:n&&"accountQueuedPosition"===n.type&&(e={type:"queued",position:n.position},"queued"===this.state.appetizeStatus.type&&this.state.appetizeStatus.position||(m.a.getInstance().logEvent("QUEUED_FOR_PREVIEW",{queuePosition:e.position}),m.a.getInstance().startTimer("previewQueue")))}e&&this.setState({appetizeStatus:e})}}),k(this,"handlePayerCodeChange",e=>this.setState({payerCodeFormStatus:{type:"open",value:e.target.value}})),k(this,"handlePayerCodeSubmit",e=>{e.preventDefault(),this.props.viewer?this.savePayerCode():this.setState({isLoggingIn:!0}),m.a.getInstance().logEvent("ENTERED_APPETIZE_CODE",{},"previewQueue")}),k(this,"handleDismissAuthModal",()=>this.setState({isLoggingIn:!1})),k(this,"handleAuthComplete",()=>{this.setState({isLoggingIn:!1}),this.savePayerCode()}),k(this,"savePayerCode",()=>{const e=this.state.payerCodeFormStatus;"open"===e.type&&e.value&&(this.props.setMetadata({appetizeCode:e.value}),this.setState({payerCodeFormStatus:{type:"submitted"}}))}),k(this,"getAppetizeOptions",(e,t)=>({sdkVersion:e.sdkVersion,channel:e.channel,platform:e.platform,screenOnly:e.screenOnly,previewQueue:e.previewQueue,payerCode:e.payerCode,viewer:e.viewer,autoplay:t.autoplay,initialId:t.initialId})),k(this,"getAppetizeURL",()=>{const e=this.getAppetizeOptions(this.props,this.state),t=e.sdkVersion,n=e.channel,a=e.platform,s=e.screenOnly,o=e.payerCode,i=e.viewer;return function(e){let t=e.sdkVersion,n=e.channel,a=e.snackId,s=e.platform,o=e.screenOnly,i=void 0!==o&&o,r=e.scale,p=e.autoplay,l=e.payerCode,c=e.previewQueue,u=e.host,d=e.deviceColor,m=void 0===d?"black":d;const g=Object(f.a)({sdkVersion:t,channel:n,snackId:a,host:u}),y={screenOnly:i,scale:r,autoplay:!!p,embed:!0,device:"ios"===s?"iphone5":"nexus5",launchUrl:"android"===s?g:void 0,xdocMsg:!0,deviceColor:m,xDocMsg:!0,orientation:"portrait",debug:!0,pc:l},v=h.a.appetize.public_keys[c][s],w={EXKernelLaunchUrlDefaultsKey:g,EXKernelDisableNuxDefaultsKey:!0};return`${h.a.appetize.url}/embed/${v}?${b.a.stringify(y)}&params=${encodeURIComponent(JSON.stringify(w))}`}({sdkVersion:t,channel:n,autoplay:e.autoplay,snackId:e.initialId,platform:a,previewQueue:e.previewQueue,screenOnly:s,deviceColor:"dark"===this.props.theme?"white":"black",scale:s?"android"===a?80:76:void 0,payerCode:i&&i.user_metadata&&i.user_metadata.appetize_code?i.user_metadata.appetize_code:o})}),k(this,"iframe",a.createRef()),k(this,"waitingForMessage",void 0),k(this,"handleTapToPlay",()=>{this.waitingForMessage||(this.requestSession(),this.waitingForMessage=setInterval(this.requestSession,1e3))}),k(this,"requestSession",()=>{this.iframe.current&&this.iframe.current.contentWindow&&this.iframe.current.contentWindow.postMessage("requestSession","*")}),k(this,"endSession",()=>{this.iframe.current&&this.iframe.current.contentWindow&&this.iframe.current.contentWindow.postMessage("endSession","*")})}static getDerivedStateFromProps(e,t){return e.platform!==t.platform||e.sdkVersion!==t.sdkVersion||e.viewer!==t.viewer&&e.viewer&&e.viewer.user_metadata&&e.viewer.user_metadata.appetize_code?{appetizeStatus:{type:"unknown"},payerCodeFormStatus:{type:"closed"},autoplay:"submitted"===t.payerCodeFormStatus.type,platform:e.platform,sdkVersion:e.sdkVersion,viewer:e.viewer}:null}componentDidMount(){window.addEventListener("message",this.handlePostMessage),window.addEventListener("unload",this.endSession),this.props.onPopupUrl(this.getAppetizeURL())}componentDidUpdate(e,t){t.appetizeStatus!==this.state.appetizeStatus&&"requested"===this.state.appetizeStatus.type?this.handleLaunchRequest():c()(this.getAppetizeOptions(e,t),this.getAppetizeOptions(this.props,this.state))||this.props.onPopupUrl(this.getAppetizeURL())}componentWillUnmount(){this.endSession(),window.removeEventListener("message",this.handlePostMessage),window.removeEventListener("unload",this.endSession)}render(){const e=this.state,t=e.appetizeStatus,n=e.payerCodeFormStatus,o=this.props,i=o.platform,r=o.screenOnly,p=o.sdkVersion,l=o.canUserAuthenticate,c=o.onClickRunOnPhone,u=o.wasUpgraded,d=o.isPopupOpen,m=this.getAppetizeURL();return a.createElement(a.Fragment,null,a.createElement("div",{className:Object(s.css)(r?E.screen:E.device)},a.createElement("iframe",{ref:this.iframe,key:m+p,src:m,className:Object(s.css)(E.frame)}),"unknown"===t.type?a.createElement("div",{className:r?Object(s.css)(E.buttonContainerEmbedded):Object(s.css)(E.buttonContainer,"ios"===i?E.buttonContainerIOS:E.buttonContainerAndroid)},u?a.createElement("div",{style:{top:90},className:Object(s.css)(E.warningText)},"This Snack was written in an SDK version that is not longer supported and has been automatically upgraded."):null,a.createElement("a",{className:Object(s.css)(E.buttonLink),style:{top:160},onClick:this.handleTapToPlay},a.createElement("div",{className:Object(s.css)(E.buttonFrame)},a.createElement("span",{className:Object(s.css)(E.buttonText)},"Tap to play"))),d?null:a.createElement("a",{className:Object(s.css)(E.buttonLink),style:{top:250},onClick:c},a.createElement("div",{className:Object(s.css)(E.buttonFrame)},a.createElement("span",{className:Object(s.css)(E.buttonText)},"Run on your device")))):null),"queued"===t.type?a.createElement("div",{className:Object(s.css)(E.queueModal,E.centered)},a.createElement("div",{className:Object(s.css)(E.queueModalContent)},l?null:a.createElement("button",{className:Object(s.css)(E.dismissButton),onClick:()=>{this.setState({appetizeStatus:{type:"unknown"}})}},"X"),a.createElement("h4",null,"Device preview is at capacity"),a.createElement("p",null,"Queue position: ",t.position||1),a.createElement("h3",null,"Don't want to wait?"),l?a.createElement("div",null,a.createElement("p",null,"Use your own Appetize.io account"),a.createElement("div",{className:Object(s.css)(E.payerCodeForm)},"open"===n.type?a.createElement("form",{onSubmit:this.handlePayerCodeSubmit},a.createElement("input",{type:"text",value:n.value,onChange:this.handlePayerCodeChange,className:Object(s.css)(E.payerCodeInput)}),a.createElement(v.a,{type:"submit",variant:"primary",className:Object(s.css)(E.button,E.activateButton)},"Activate")):"submitted"===n.type?a.createElement("p",{className:Object(s.css)(E.payerCodeSubmitted)},"Payer code saved to profile!"):a.createElement(w.a,{variant:"primary",href:`${h.a.appetize.url}/payer-code`,onClick:this.handlePayerCodeLink,target:"_blank",className:Object(s.css)(E.button,E.blockButton)},"Use Appetize.io")),a.createElement("p",null,"or")):null,a.createElement(w.a,{variant:"primary",onClick:c,className:Object(s.css)(E.button,E.blockButton)},"Run it on your phone"))):null,a.createElement(y.a,{visible:this.state.isLoggingIn,onDismiss:this.handleDismissAuthModal,onComplete:this.handleAuthComplete}))}}));const E=s.StyleSheet.create({loading:{position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:1},centered:{display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},device:{position:"relative",height:653,width:324,overflow:"hidden",margin:"auto",zIndex:2},screen:{position:"relative",height:508,width:285,overflow:"hidden",margin:"auto",zIndex:2},frame:{width:9999,height:9999,border:0,overflow:"hidden"},queueModal:{color:"white",backgroundColor:"rgba(36, 43, 56, 0.8)",position:"absolute",zIndex:2,top:0,left:0,right:0,bottom:0,padding:28},queueModalContent:{textAlign:"center"},qrcode:{margin:"21px 7px",height:208,width:208,backgroundColor:"#fff",border:"4px solid #fff",borderRadius:3},buttons:{display:"flex",flexDirection:"row"},button:{backgroundRepeat:"no-repeat",backgroundPosition:".5em center"},buttonPadding:{paddingLeft:"24px"},downloadButton:{flex:1},blockButton:{cursor:"pointer",display:"block",flex:1},activateButton:{":only-of-type":{marginLeft:0,marginRight:0,borderBottomLeftRadius:0,borderTopLeftRadius:0}},playstore:{backgroundImage:`url(${n(590)})`,backgroundSize:"20px 23px",paddingLeft:21,paddingRight:7},appstore:{backgroundImage:`url(${n(536)})`,backgroundSize:"12px 23px"},payerCodeForm:{height:50,display:"flex",flexDirection:"row"},payerCodeInput:{fontFamily:"var(--font-monospace)",padding:7,marginRight:-1,borderTopLeftRadius:3,borderBottomLeftRadius:3,width:133,border:`1px solid ${d.a.border}`,color:d.a.text.light},payerCodeSubmitted:{margin:"0 auto",padding:14,textAlign:"center",color:d.a.success},buttonContainer:{position:"absolute",top:0,left:0,bottom:0},buttonContainerAndroid:{right:24},buttonContainerIOS:{right:12},buttonContainerEmbedded:{position:"absolute",top:-70,left:0,right:0,bottom:0},warningText:{color:"white",fontSize:"12px",left:20,position:"absolute",width:"90%",paddingLeft:"20px",paddingRight:"20px",textAlign:"center"},buttonLink:{position:"absolute",left:0,right:0,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},buttonFrame:{height:70,width:225,backgroundColor:d.a.content.light,borderRadius:30,alignItems:"center",justifyContent:"center",display:"flex",paddingLeft:20,paddingRight:20},buttonText:{color:d.a.content.dark,fontSize:20,fontWeight:400},dismissButton:{position:"absolute",fontSize:20,fontWeight:400,right:0,top:0,zIndex:2,height:48,width:48,padding:16,border:0,backgroundSize:16,backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundColor:"transparent"}});n(64);var I=Object(r.a)(function(e){let t=e.previewRef,n=e.sdkVersion,o=e.channel,i=e.snackId,r=e.onPopupUrl,p=e.theme;const l=Object(f.a)({sdkVersion:n,channel:o,snackId:i}),c=`/web-player/${n.split(".")[0]}/index.html?initialUrl=${encodeURIComponent(l)}`;return a.useEffect(()=>r(c),[c]),a.createElement("div",{className:Object(s.css)(S.pane)},a.createElement("iframe",{ref:e=>t.current=e?e.contentWindow:null,src:c,allow:"geolocation; camera; microphone",className:Object(s.css)(S.frame,"dark"===p?S.frameDark:S.frameLight)}))});const S=s.StyleSheet.create({pane:{position:"relative",display:"flex",flex:1,width:324,height:"100%"},frame:{position:"relative",width:"100%",height:"100%",border:0,zIndex:1},frameLight:{backgroundColor:"#fefefe"},frameDark:{backgroundColor:"#ffffff"},spinnerContainer:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"}});var O=n(591);function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"VISIBILITY_MEDIA_QUERY",function(){return x});const x="(min-width: 700px)";t.default=Object(r.a)(class extends a.PureComponent{constructor(){super(...arguments),P(this,"state",{isRendered:!1,isPopupOpen:!1}),P(this,"handleMediaQuery",e=>this.setState({isRendered:e.matches})),P(this,"handlePopup",()=>{this.popup=window.open(this.state.popupUrl,"snack-device","width=327,height=668"),this.popup&&this.popup.closed||(this.setState({isPopupOpen:!0},()=>{this.props.previewRef.current=this.popup}),clearInterval(this.popupInterval),this.popupInterval=setInterval(()=>{this.popup&&!this.popup.closed||(clearInterval(this.popupInterval),this.popup=null,this.setState({isPopupOpen:!1}))},500))}),P(this,"handlePopupUrl",e=>this.setState({popupUrl:e})),P(this,"popupInterval",void 0),P(this,"popup",null),P(this,"mql",null)}componentDidMount(){this.mql=window.matchMedia(x),this.mql.addListener(this.handleMediaQuery),this.handleMediaQuery(this.mql)}componentDidUpdate(e,t){this.state.isPopupOpen&&t.popupUrl!==this.state.popupUrl&&this.handlePopup()}componentWillUnmount(){clearInterval(this.popupInterval),this.mql&&this.mql.removeListener(this.handleMediaQuery),this.popup&&this.popup.close()}render(){const e=this.state,t=e.isPopupOpen;if(!e.isRendered||t)return null;const n=this.props,o=n.canUserAuthenticate,r=n.channel,l=n.onAppLaunch,c=n.onChangePlatform,u=n.onClickRunOnPhone,d=n.payerCode,h=n.platform,m=n.previewQueue,g=n.previewRef,b=n.screenOnly,f=n.sdkVersion,y=n.snackId,v=n.supportedPlatformsQueryParam,w=n.theme,k=n.wasUpgraded;let E=O.a({sdkVersion:f,supportedPlatformsQueryParam:v}),S=O.b({sdkVersion:f,requestedPlatform:h,options:E});return a.createElement("div",{className:i()(Object(s.css)(b?L.centered:L.container),this.props.className)},b?null:a.createElement("div",{className:Object(s.css)(L.header)},a.createElement(p.a,{options:E,value:S,onValueChange:c,className:Object(s.css)(L.toggleButtons)}),a.createElement("button",{className:Object(s.css)(L.popupButton,"dark"===w?L.popupButtonDark:L.popupButtonLight),onClick:this.handlePopup})),"web"===S?a.createElement(I,{previewRef:g,sdkVersion:f,channel:r,snackId:y,onPopupUrl:this.handlePopupUrl}):a.createElement(C,{sdkVersion:f,channel:r,platform:S,canUserAuthenticate:o,wasUpgraded:k,previewQueue:m,snackId:y,screenOnly:b,payerCode:d,isPopupOpen:t,onPopupUrl:this.handlePopupUrl,onClickRunOnPhone:u,onAppLaunch:l}))}});const L=s.StyleSheet.create({container:{position:"relative",maxWidth:"50%",overflow:"auto",display:"none",flexDirection:"column",[`@media ${x}`]:{display:"flex"}},header:{display:"flex",alignItems:"center",justifyContent:"center",margin:"8px 0"},toggleButtons:{zIndex:3},popupButton:{position:"absolute",right:0,zIndex:2,appearance:"none",height:48,width:48,padding:16,margin:0,border:0,outline:0,opacity:.8,backgroundSize:16,backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundColor:"transparent",transition:".2s",":hover":{opacity:1}},popupButtonDark:{backgroundImage:`url(${n(520)})`},popupButtonLight:{backgroundImage:`url(${n(519)})`},centered:{display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"}})}}]);